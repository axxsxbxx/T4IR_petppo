{% extends 'basesimple.html' %}

{% block headcontent %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
   integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
   crossorigin=""></script>
{% endblock %}

{% block mycontent %}


<button onclick="getLocation()">현재 위치로 검색</button>
<p id="mes"></p>
<button onclick="searchaddress()">주소 입력해서 검색</button>
<form>
    <input id="search" type="text" placeholder="주소를 입력하세요" required>
    <input type="button" value="검색" onclick="addToCoord()">
</form>

<div id="mapid1" style="width: 600px; height: 400px;"></div>
<div id="mapid2" style="width: 600px; height: 400px;"></div>
<div id="mapid3" style="width: 600px; height: 400px;"></div>

<script>
    var mymap1 = L.map('mapid1').setView([37.566, 126.978], 10);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery <a href="https://www.m/* apbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap1);

	var x = document.getElementById("mes");

     function getLocation() {
         if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition,showError);
         }
         else {
        	 x.innerHTML=" 이 브라우저는 geolocation을 지원하지 않습니다.";
       	 }
      }
    function showPosition(position) {
          var lat = position.coords.latitude;
          var lng = position.coords.longitude;
          var mymap2 = L.map('mapid2').setView([lat, lng], 15)
		  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
					'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery <a href="https://www.mapbox.com/">Mapbox</a>',
				id: 'mapbox.streets'
			}).addTo(mymap2);
		  L.marker([lat, lng]).addTo(mymap2);
	}
    function showError(error) {
        switch(error.code) {
            case error.PERMISSION_DENIED:
               	x.innerHTML="사용자가 위치 기능 사용을 거부했습니다."
            	break;

            case error.POSITION_UNAVAILABLE:
            	x.innerHTML="위치를 구할 수 없습니다.";
           	 	break;

            case error.TIMEOUT:
           	 	x.innerHTML="사용자가 위치 기능 사용을 거부했습니다.";
            	break;
            case error.UNKNOWN_ERROR:
            	x.innerHTML="기타 에러";
         }
      }

    function addToCoord() {
		var address = document.getElementById("search").value
		var lat;
		var lng;

		if (address) {
			var xhr = new XMLHttpRequest();
			xhr.onload =  function() {
				if(xhr.status == 200) {
					var data = JSON.parse(xhr.responseText);
					lat = data.results[0].geometry.location.lat;
					lng = data.results[0].geometry.location.lng;

					if(mymap3)
						mymap3.remove();
					var mymap3 = L.map('mapid3').setView([lat, lng], 16)
					L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
						maxZoom: 18,
						attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
							'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
							'Imagery <a href="https://www.mapbox.com/">Mapbox</a>',
						id: 'mapbox.streets'
					}).addTo(mymap3);

					L.marker([lat, lng]).addTo(mymap3);
				}
			};

			xhr.open("GET", "https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyDy81EbO46BRSnX1DOgg_F84bhsdbku2z4&address="+encodeURIComponent(address), true);
			xhr.send();
		}
	}
</script>

{% endblock %}